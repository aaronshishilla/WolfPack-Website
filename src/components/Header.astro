---
import { getMenu, stripWpDomain } from "@/lib/wordpress";

let menuItems: { label: string; path: string }[] = [];

try {
  const items = await getMenu("primary");
  menuItems = items.map((item) => ({
    label: item.label,
    path: stripWpDomain(item.path || item.url),
  }));
} catch {
  menuItems = [
    { label: "Home", path: "/" },
    { label: "Services", path: "/services" },
    { label: "Case Studies", path: "/case-studies" },
    { label: "Blog", path: "/blog" },
    { label: "Team", path: "/team" },
    { label: "Contact", path: "/contact" },
  ];
}

const currentPath = Astro.url.pathname;
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 group">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-[var(--color-brand-accent)] to-[var(--color-brand-accent-light)] flex items-center justify-center transition-transform duration-300 group-hover:scale-110">
          <span class="text-white font-extrabold text-lg">W</span>
        </div>
        <span class="text-xl font-bold text-[var(--color-brand-dark)] header-logo-text transition-colors duration-300">
          WolfPack
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-1">
        {menuItems.map((item) => (
          <a
            href={item.path}
            class:list={[
              "relative px-4 py-2 text-sm font-medium rounded-lg transition-all duration-300",
              currentPath === item.path || (item.path !== "/" && currentPath.startsWith(item.path + "/"))
                ? "text-[var(--color-brand-accent)] bg-[var(--color-brand-accent)]/10"
                : "text-[var(--color-brand-dark)] header-nav-link hover:text-[var(--color-brand-accent)] hover:bg-[var(--color-brand-accent)]/5",
            ]}
          >
            {item.label}
          </a>
        ))}
        <a
          href="/contact"
          class="ml-4 px-5 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-[var(--color-brand-accent)] to-[var(--color-brand-accent-light)] rounded-lg hover:shadow-lg hover:shadow-[var(--color-brand-accent)]/25 transition-all duration-300 hover:-translate-y-0.5"
        >
          Get Started
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="md:hidden relative w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-100 transition-colors"
        aria-label="Toggle menu"
        aria-expanded="false"
      >
        <div class="hamburger-lines">
          <span class="block w-5 h-0.5 bg-[var(--color-brand-dark)] transition-all duration-300 origin-center"></span>
          <span class="block w-5 h-0.5 bg-[var(--color-brand-dark)] transition-all duration-300 mt-1.5"></span>
          <span class="block w-3 h-0.5 bg-[var(--color-brand-dark)] transition-all duration-300 mt-1.5"></span>
        </div>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden overflow-hidden">
      <div class="pb-6 pt-2 space-y-1">
        {menuItems.map((item) => (
          <a
            href={item.path}
            class:list={[
              "block px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200",
              currentPath === item.path
                ? "text-[var(--color-brand-accent)] bg-[var(--color-brand-accent)]/10"
                : "text-[var(--color-brand-dark)] hover:bg-gray-100",
            ]}
          >
            {item.label}
          </a>
        ))}
        <div class="pt-2 px-4">
          <a
            href="/contact"
            class="block w-full text-center px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-[var(--color-brand-accent)] to-[var(--color-brand-accent-light)] rounded-lg"
          >
            Get Started
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer to prevent content from hiding behind fixed header -->
<div class="h-20"></div>

<script>
  const header = document.getElementById("site-header");
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");

  // Glassmorphism on scroll
  let lastScroll = 0;
  window.addEventListener("scroll", () => {
    const scrollY = window.scrollY;
    if (scrollY > 20) {
      header?.classList.add("glass", "shadow-sm");
    } else {
      header?.classList.remove("glass", "shadow-sm");
    }
    lastScroll = scrollY;
  }, { passive: true });

  // Initial check
  if (window.scrollY > 20) {
    header?.classList.add("glass", "shadow-sm");
  }

  // Mobile menu toggle
  btn?.addEventListener("click", () => {
    const expanded = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", String(!expanded));
    menu?.classList.toggle("hidden");
  });
</script>
